/* ===== Brassreach Skin v13 ===== */
:root{
  --bg:#0c0f12; --bg2:#14181d; --ink:#e6d9a2; --ink2:#f1e6bb;
  --gold:#d5a84a; --gold2:#9a6b24; --crimson:#7b2a2a; --emerald:#3a6f5b;
  --line:#6f5320; --line2:#caa45a; --accent:#e0c98a; --muted:#c8bb87;
  --white:#f5f2e6;
}

/* Base */
html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:"Josefin Sans", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif;}
*{box-sizing:border-box}

/* Boot */
.boot{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,#0c0f12,#0a0d10)}
.boot .box{padding:14px 18px;border:1px solid #2e2a20;border-radius:8px;background:#11161c;color:#e0d6b2}
.boot.ok{display:none}

/* Crest watermark + parallax container */
.app{position:relative;min-height:100vh}
.crest{
  position:fixed; inset:0; pointer-events:none; opacity:.12; 
  background:
    radial-gradient(1000px 700px at 25% 10%, #1a232b 0%, #0c0f12 60%),
    url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width=\"1200\" height=\"1200\" viewBox=\"0 0 1200 1200\">\
 <defs>\
  <linearGradient id=\"g\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\
    <stop offset=\"0%\" stop-color=\"#996b2e\"/>\
    <stop offset=\"100%\" stop-color=\"#3e2b12\"/>\
  </linearGradient>\
 </defs>\
 <g fill=\"none\" stroke=\"url(#g)\" stroke-width=\"8\" opacity=\"0.7\">\
  <circle cx=\"600\" cy=\"580\" r=\"320\"/>\
  <path d=\"M280,580 L600,240 L920,580 L600,920 Z\"/>\
  <path d=\"M430,580 L600,400 L770,580 L600,760 Z\"/>\
  <path d=\"M600,260 L600,900\"/>\
  <path d=\"M260,580 L940,580\"/>\
 </g>\
</svg>') center/700px 700px no-repeat;
  transform:translate3d(0,0,0);
}

/* Masthead */
.masthead{position:relative;padding:22px 18px 12px;border-bottom:2px solid var(--line);}
.brand-title{
  font-family:"Cinzel", serif; font-weight:700; text-align:center; letter-spacing:1.2px;
  font-size:2.05rem; color:var(--ink2);
  text-shadow:
    0 0 22px rgba(213,168,74,.35),
    0 0 6px rgba(213,168,74,.55),
    0 0 1px rgba(255,200,120,.9);
  filter: drop-shadow(0 0 24px rgba(255,140,40,.25));
}

/* Toolbar */
.toolbar{display:flex;justify-content:center;margin-top:10px}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

/* Buttons */
.btn{
  background:linear-gradient(180deg,#212833,#131921);
  color:var(--white); border:2px solid var(--line);
  padding:10px 12px; cursor:pointer; transition:transform .05s ease, filter .15s ease;
  position:relative; box-shadow:0 0 0 2px var(--line2) inset;
}
.btn.gold{background:linear-gradient(180deg,#4b3917,#2b2212);border-color:var(--gold2);box-shadow:0 0 0 2px var(--gold) inset}
.btn:hover{filter:brightness(1.05)}
.btn:active{transform:scale(0.985)}
.btn::after{ /* click pulse */
  content:""; position:absolute; inset:-2px; pointer-events:none; opacity:0; border:2px solid var(--gold);
  transition:opacity .18s ease;
}
.btn:active::after{opacity:.7}

/* Squared double-lined cards w/ chevrons */
.card{background:linear-gradient(180deg,var(--bg2),#0c0f12); position:relative; padding:12px; margin:10px; color:var(--ink);
  border:2px solid var(--line); box-shadow:0 0 0 2px var(--line2) inset;}
.card h3{margin:0 0 8px 0; text-align:center; font-weight:700; letter-spacing:.6px}
.card .inner{position:relative}
.card .corners::before, .card .corners::after{content:""; position:absolute; width:18px; height:18px; border-top:2px solid var(--line2); border-left:2px solid var(--line2); }
.card .corners::before{left:8px; top:8px; transform:rotate(45deg)}
.card .corners::after{right:8px; bottom:8px; transform:rotate(225deg)}

/* Layout */
.main{display:grid; grid-template-columns: 1fr 320px; gap:12px; padding:12px}
@media (max-width: 1080px){ .main{grid-template-columns:1fr} }

/* Story box */
.storywrap .cardish{}
.story-scroll{
  min-height:56vh; max-height:68vh; overflow:auto; padding:18px;
  background:linear-gradient(180deg,#0e141a 0%, #0a0f14 100%);
  border:2px solid var(--line); box-shadow:0 0 0 2px var(--line2) inset; position:relative;
}
.story-scroll p{ margin:12px 0; line-height:1.55; color:var(--ink2); position:relative; padding-left:26px }
.story-scroll p::before{ /* chevron bullet */
  content:"‚ùØ"; position:absolute; left:6px; top:2px; color:var(--gold); opacity:.9; text-shadow:0 0 6px rgba(213,168,74,.35);
}
.rollglyph{opacity:.8; margin-left:6px; cursor:help}

/* Choice area */
.choices{margin-top:10px; padding:10px; border:2px solid var(--line); box-shadow:0 0 0 2px var(--line2) inset; background:#10151a}
.choice-btn{display:block;width:100%;text-align:left;margin:6px 0;padding:12px;background:linear-gradient(180deg,#151b24,#0e1319);border:1px solid var(--gold2);color:var(--white);cursor:pointer}
.choice-btn:hover{filter:brightness(1.08)}

/* Free action row */
.free{display:flex;gap:8px;margin-top:8px}
.free input{flex:1;background:#0d141a;border:1px solid var(--gold2);padding:10px;border-radius:4px;color:var(--white)}
.free .btn.gold{font-weight:700}

/* Right column */
.side .card{ text-align:center }
#ledgerList{ display:flex; flex-wrap:wrap; gap:6px; justify-content:center }
.pill{border:1px solid var(--gold2);padding:4px 8px;border-radius:999px;background:#0b1117;font-size:.95rem}

/* Success / fail saturation behavior */
.glow-success{ color:var(--gold); filter:saturate(1.0); animation:fadeSat 4s forwards }
.glow-fail{ color:var(--crimson); filter:saturate(1.0); animation:fadeSat 4s forwards }
@keyframes fadeSat{ to{ filter:saturate(.33) } }
.glow-success:hover{ animation:none; filter:saturate(.5) drop-shadow(0 0 5px rgba(213,168,74,.6)) }
.glow-fail:hover{ animation:none; filter:saturate(.5) drop-shadow(0 0 5px rgba(123,42,42,.6)) }

/* Typewriter reveal & smoke cursor */
.reveal .ch.on{opacity:1}
.reveal .cursor{display:inline-block; width:10px; height:1.2em; vertical-align:-.2em; position:relative}
.smoke{display:inline-block;width:10px;height:10px;border-radius:50%;
  background:radial-gradient(circle at 50% 50%, rgba(240,240,240,.5), rgba(240,240,240,0) 70%);
  animation:smoke .7s linear infinite;}
@keyframes smoke{ 0%{transform:translateY(0) scale(1)} 100%{transform:translateY(-6px) scale(1.2); opacity:.1}}

/* Scroll icon (hidden until main app mounts) */
.scroll-btn{
  position:fixed; top:14px; right:14px; width:40px; height:40px; display:none;
  background:#1a212a; border:1px solid var(--gold2); box-shadow:0 0 0 2px var(--gold) inset; cursor:pointer;
}
.scroll-btn svg{width:100%;height:100%;filter:drop-shadow(0 0 6px rgba(213,168,74,.4))}
.scroll-btn:hover{filter:brightness(1.08)}

/* Modals */
.shade{position:fixed;inset:0;background:#0008;z-index:9998;display:none}
.modal{position:fixed;top:8%;left:50%;transform:translateX(-50%);width:min(720px,92vw);background:#0f141a;border:2px solid var(--line);box-shadow:0 0 0 2px var(--line2) inset;border-radius:0;padding:0;z-index:9999;display:none}
.modal header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:2px solid var(--line)}
.modal .content{padding:14px; max-height:70vh; overflow:auto}
.closeX{cursor:pointer;border:1px solid var(--gold2);padding:4px 8px}

/* Settings grid and sliders */
.settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.settings-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
input[type="range"]{width:100%}

/* Intro slides */
.intro{position:fixed;inset:0;background:#0a0f14;z-index:9000;display:flex;flex-direction:column}
.intro .pane{flex:1;display:grid;grid-template-columns:1fr 1fr;gap:0}
.intro .txt{position:relative;padding:30px 40px;overflow:hidden}
.intro .txt .inner{max-width:680px;margin:0 auto;font-size:1.05rem;line-height:1.6;color:var(--ink2);position:relative}
.intro .pic{position:relative;overflow:hidden}
.intro .pic .img{position:absolute;inset:-6%;background:radial-gradient(120% 100% at 50% 30%, #1a232b, #0a0f14 65%)}
.intro .nav{display:flex;justify-content:flex-end;gap:10px;padding:10px 20px;border-top:2px solid var(--line);background:#0d1218}
.intro .btn{min-width:120px}

/* Tooltips for glossary (never clipped) */
.gloss{position:relative;color:var(--accent);cursor:help}
.gloss .tip{
  position:absolute; left:0; bottom:100%; transform:translateY(-10px);
  background:#10161c; border:1px solid var(--gold2); color:var(--white); padding:8px 10px; white-space:normal; 
  max-width: min(420px, 70vw); line-height:1.35; box-shadow:0 12px 50px rgba(0,0,0,.5);
  opacity:0; pointer-events:none; transition:opacity .12s ease; border-radius:6px;
}
.gloss:hover .tip{opacity:1}
/* auto shift when near edges; JS adjusts left dynamically */

/* Scrollbars */
.story-scroll::-webkit-scrollbar{width:10px}
.story-scroll::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#4b3917,#2b2212);border:2px solid #2b2212;border-radius:6px}
.story-scroll::-webkit-scrollbar-track{background:#0f1419}

/* Number inputs accent */
input[type="number"]{accent-color:var(--gold)}

/* Intro overlay must sit above the app and receive clicks */
#intro.intro{
  position: fixed; inset: 0; z-index: 9999;
  display: block; pointer-events: auto;
  background: rgba(6,6,10,.82); /* subtle veil */
}

/* Each slide stacks its nav above any art */
#intro .slide{ position: relative; }
#intro .slide .nav{
  position: absolute; right: 18px; bottom: 18px;
  z-index: 3;
}

/* Decorative layers never eat clicks */
#intro .slide .img,
#intro .slide .mist{ pointer-events: none; }

/* Make the copy area non-scrolling (no scrollbar) but roomy */
#intro .copy .scroll{
  overflow: visible; /* no scrollbar */
  max-width: 70ch;   /* more elbow-room for tooltip popouts */
  padding: 12px 18px;
}

/* Glossary tips: edge-aware defaults; fade in/out quickly */
.gloss{ position: relative; cursor: help; }
.gloss .tip{
  position: absolute; top: 100%; left: 0;
  transform: translateY(6px);
  background: #0f1016; color: #f1e6d4;
  border: 1px solid #b7822b; padding: 8px 10px;
  max-width: 36ch; filter: drop-shadow(0 4px 8px rgba(0,0,0,.4));
  opacity: 0; pointer-events: none; transition: opacity .12s ease;
  white-space: normal; line-height: 1.35;
}
.gloss:hover .tip{ opacity: 1; }

/* Ensure the app underneath never steals focus while intro is open */
#intro:not(.hidden) ~ .app{ pointer-events: none; }
