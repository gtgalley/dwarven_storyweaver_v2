:root{
  --bg:#0c0f12; --bg2:#14181d; --ink:#e6d9a2;
  --ink-dim:#c8bb87; --gold:#d5a84a; --gold2:#9a6b24;
  --silver1:#bfc5cc; --silver2:#8d96a1; --link:#e0c98a;
  --success:#e5c36a; --fail:#9b3131;
}
.hidden{ display:none !important; }

/* shade starts hidden; engine toggles .hidden on modals */
.shade{ display:none; }
.shade:not(.hidden){ display:block; }

/* ---------- Base ---------- */
html,body{
  height:100%; margin:0; color:var(--ink);
  font-family: "Josefin Sans","Segoe UI", system-ui, -apple-system, Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif;
  letter-spacing:.2px;
  background:
    radial-gradient(1200px 800px at 20% 10%, #172027, #0c0f12 60%),
    repeating-linear-gradient(135deg, rgba(213,168,74,.04) 0 8px, transparent 8px 16px),
    var(--bg);
}
a{ color:var(--link) }

/* ---------- Masthead ---------- */
.masthead{ padding:24px 12px 10px; text-align:center; }
.brand-title{
  font-family:"Cinzel",serif; letter-spacing:.8px; margin:0 0 10px;
  font-weight:700; font-size:28px; color:var(--gold); text-shadow:0 0 10px rgba(213,168,74,.25);
}
.toolbar{ display:flex; justify-content:center; }
.cardish{
  background:linear-gradient(180deg,#171a20,#11151a);
  border:1px solid #2b2f36; border-radius:10px; padding:10px 12px;
}

/* ---------- Controls ---------- */
.controls{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; }
.controls .tag{
  background:rgba(213,168,74,.08);
  border:1px solid var(--gold2); color:var(--gold);
  padding:2px 8px; border-radius:999px; margin-left:6px;
}
.btn{
  border:1px solid #3a3326;
  background:linear-gradient(180deg,#1f1c16,#141316);
  color:#e8ddba; border-radius:8px; padding:7px 12px;
  transition:transform .06s ease, box-shadow .15s ease, filter .15s ease;
  cursor:pointer;
}
.btn:hover{ filter:brightness(1.07); box-shadow:0 0 0 1px var(--gold2) inset; }
.btn:active{ transform:translateY(1px); }

/* ACT & Continue */
.btn-act{
  background:linear-gradient(180deg,#d3d7dc,#9aa3ad);
  color:var(--gold); border-color:var(--silver2);
  text-shadow:0 1px 0 rgba(0,0,0,.3);
}
.btn-continue{
  background:linear-gradient(180deg,#1c1c22,#121218);
}

/* click pulse */
.pulse{ box-shadow:0 0 0 2px var(--gold2) inset !important; filter:brightness(1.12) !important; }

/* ---------- Layout ---------- */
.app{ position:relative; }
.main{ position:relative; z-index:2; display:grid; grid-template-columns: 1.1fr 0.9fr; gap:14px; padding:12px; }
@media (max-width: 1100px){ .main{ grid-template-columns:1fr; } }

.story-scroll{
  position:relative; min-height:52vh; max-height:68vh; overflow:auto; padding:16px 16px 22px;
  border:1px solid #2b2b35; border-radius:10px;
  background:
    radial-gradient(1000px 600px at 15% 0%, rgba(213,168,74,.05), transparent),
    #0f1016;
}

/* Watermark + vignette */
.story-scroll::after{
  content:""; position:absolute; inset:0; pointer-events:none; opacity:.08;
  background-repeat:repeat; background-size:360px 360px; background-position:center;
  background-image:url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='360' height='360' viewBox='0 0 380 380'>\
<defs>\
  <radialGradient id='g' cx='50%' cy='50%' r='60%'>\
    <stop offset='0%' stop-color='%23d5a84a' stop-opacity='.5'/>\
    <stop offset='60%' stop-color='%23d5a84a' stop-opacity='.15'/>\
    <stop offset='100%' stop-color='%230c0f12' stop-opacity='0'/>\
  </radialGradient>\
  <pattern id='p' patternUnits='userSpaceOnUse' width='380' height='380'>\
    <g opacity='.8'>\
      <circle cx='190' cy='190' r='120' fill='url(%23g)'/>\
      <g stroke='%23d5a84a' stroke-opacity='.35' stroke-width='4' fill='none'>\
        <circle cx='190' cy='190' r='138'/>\
        <path d='M190 40 L210 80 L260 90 L220 120 L230 170 L190 145 L150 170 L160 120 L120 90 L170 80 Z'/>\
        <path d='M190 250 l40 25 -15 45 -25 -35 -25 35 -15 -45z'/>\
      </g>\
    </g>\
  </pattern>\
</defs>\
<rect width='100%' height='100%' fill='url(%23p)'/>\
</svg>");
}
.story-scroll::before{
  content:""; position:absolute; inset:-2px; border-radius:12px; pointer-events:none;
  background:radial-gradient(120% 80% at 50% 0%, transparent 60%, rgba(0,0,0,.35) 100%);
}

/* story text */
.story-scroll p{ margin:0 0 12px 0; line-height:1.48; font-size:1.05rem; color:var(--ink); }

/* success/fail glow for ~2s */
@keyframes beatGood { 0%{text-shadow:0 0 12px rgba(229,195,106,.55); color:#f0e5b8;} 100%{text-shadow:none; color:var(--ink);} }
@keyframes beatBad  { 0%{text-shadow:0 0 10px rgba(155,49,49,.55); color:#f0c2c2;} 100%{text-shadow:none; color:var(--ink);} }
.beat-good{ animation:beatGood 2s ease forwards; }
.beat-bad{  animation:beatBad  2s ease forwards; }

/* choice list */
.choices{ padding:10px; }
.choice-btn{
  display:block; width:100%; text-align:left; margin:6px 0; padding:12px 12px;
  border:1px solid #3a3326; border-radius:8px;
  background:linear-gradient(180deg,#1c1a16,#121115); color:var(--gold);
  transition:transform .06s ease, box-shadow .15s ease, filter .15s ease;
}
.choice-btn:hover{ filter:brightness(1.06); box-shadow:0 0 0 1px var(--gold2) inset; }
.choice-btn:active{ transform:translateY(1px); }

/* free input */
.free{ display:flex; gap:8px; margin-top:8px; }
.free input{
  flex:1; padding:10px 12px; border-radius:8px;
  background:#161a20; color:#f2e9c6; border:1px solid #6b5322;
}

/* side panels */
.side{ display:flex; flex-direction:column; gap:14px; }
.panel h3{
  font-family:"Cinzel",serif; letter-spacing:.4px; margin:0 0 8px; font-weight:600; font-size:16px; color:#e9ddbb;
}
.panel{ padding:12px; }
.panel, .choices{ border:1px solid #2b2b35; border-radius:10px; }

/* modals */
.shade{ position:fixed; inset:0; background:#0008; z-index:9998; }
.modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:9999; }
.modal.hidden{ display:none !important; }
.modal .inner{ width:min(760px,92vw); background:#0e141a; border:1px solid var(--gold2); border-radius:12px; box-shadow:0 20px 80px rgba(0,0,0,.5) }
.modal .inner header{ display:flex; justify-content:space-between; align-items:center; padding:12px 16px; border-bottom:1px solid var(--gold2) }
.modal .inner .content{ padding:16px }
.closeX{ cursor:pointer; border:1px solid var(--gold2); padding:4px 8px; border-radius:6px }

/* small helpers */
.btn-row{ display:flex; gap:8px; flex-wrap:wrap }
.rollglyph{ font-size:.9em; opacity:.85; margin-left:6px; cursor:help }
